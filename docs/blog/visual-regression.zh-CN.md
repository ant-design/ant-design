---
title: ğŸ‘€ è§†è§‰å›å½’æµ‹è¯•
date: 2025-01-05
author: Wxh16144
---

è§†è§‰å›å½’æµ‹è¯•ï¼ˆVisual Regression Testingï¼‰æ˜¯ä¸€ç§è½¯ä»¶æµ‹è¯•æŠ€æœ¯ï¼Œä¸“æ³¨äºæ£€æµ‹ Web åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™çš„ç”¨æˆ·ç•Œé¢ä¸­çš„è§†è§‰å˜åŒ–å’Œå·®å¼‚, å®ƒæ¶‰åŠåœ¨ä¸åŒçš„å¼€å‘é˜¶æ®µæ•è·ç½‘é¡µçš„å±å¹•æˆªå›¾ï¼Œå¹¶è¿›è¡Œæ¯”è¾ƒï¼Œç”¨æ¥è¯†åˆ«ç”±ä»£ç æ›´æ”¹æˆ–æ›´æ–°å¼•èµ·çš„ä»»ä½•æ„å¤–çš„è§†è§‰å›å½’ã€‚

## åŸºå‡†æˆªå›¾

Ant Design è§†è§‰å›å½’æµ‹è¯•çš„ä¸»è¦ç›®æ ‡æ˜¯æ£€æµ‹ç»„ä»¶çš„è§†è§‰å˜åŒ–ï¼Œé¿å… PR æ”¹åŠ¨å¼•å…¥çš„è§†è§‰é—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨ [jest-puppeteer](https://jestjs.io/docs/puppeteer) ä½œä¸ºæµ‹è¯•æ¡†æ¶ã€‚å°† Puppeteer ä¸ Jest ç»“åˆä½¿ç”¨ï¼Œå¯¹æ¯ä¸€ä¸ªç»„ä»¶ Demo è¿›è¡Œæˆªå›¾ï¼Œç„¶åä¸åŸºå‡†æˆªå›¾è¿›è¡Œæ¯”è¾ƒã€‚

å¯ä»¥çœ‹åˆ°æ¯ä¸ªç»„ä»¶ä¸‹çš„ `__tests__/image.test.ts` é‡Œé¢åŒ…å«äº†è§†è§‰å›å½’æµ‹è¯•çš„ä»£ç , ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨ antd ä»“åº“ä¸­è¿è¡Œè§†è§‰æˆªå›¾:

```bash
npm run test:image # æˆªå›¾å°†ä¼šä¿å­˜åœ¨ imageSnapshots ç›®å½•ä¸‹, æŒ‡å®šç»„ä»¶æˆªå›¾å¯ä»¥ä½¿ç”¨ npm run test:image -- components/button
```

## è§†è§‰å›å½’æ–¹æ¡ˆ

### Argos

æ—©æœŸæˆ‘ä»¬ä½¿ç”¨ [Argos](https://argos-ci.com/) ä½œä¸ºè§†è§‰å›å½’æµ‹è¯•çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ Argos ä¿®æ”¹äº†æ”¶è´¹ç­–ç•¥ï¼Œantd åœ¨æ¯æ¬¡ PR ä¸­éƒ½ä¼šè§¦å‘è§†è§‰å›å½’æµ‹è¯•ï¼Œæ¯æ¬¡å¯¹æ¯”å°†è¿‘ 6,000 å¼ æˆªå›¾ï¼Œè¿™æ ·çš„è´¹ç”¨æ˜¯æˆ‘ä»¬æ— æ³•æ‰¿å—çš„ã€‚

### Self-hosted

æˆ‘ä»¬è‡ªå»ºäº†è§†è§‰å›å½’æµ‹è¯•çš„æ–¹æ¡ˆï¼Œåˆ©ç”¨å‰é¢æåˆ°çš„ jest-puppeteerï¼Œå°†æ¯ä¸€ä¸ªç»„ä»¶çš„ Demo åˆ†åˆ«ä½¿ç”¨ `dark`ã€`light`ã€`compact` ä»¥åŠ `cssVar` å››ç§ä¸»é¢˜è¿›è¡Œæˆªå›¾ï¼Œç„¶åå°†æˆªå›¾ä¸Šä¼ åˆ° [é˜¿é‡Œäº‘ OSS](https://www.aliyun.com/product/oss) ä¸­ï¼Œä½œä¸ºåŸºå‡†æˆªå›¾ã€‚

åˆ©ç”¨ GitHub Actions æŒç»­é›†æˆï¼Œå¯ä»¥åœ¨æ¯æ¬¡åŸºå‡†åˆ†æ”¯çš„ä»£ç å˜åŠ¨æ—¶ï¼Œè‡ªåŠ¨æˆªå›¾å¹¶ä¸Šä¼ åˆ° OSS ä¸­ï¼Œè¿™æ ·å°±ä¿è¯äº†åŸºå‡†æˆªå›¾çš„å®æ—¶æ€§ã€‚

å¯¹äºéœ€è¦è¿›è¡Œè§†è§‰å›å½’æµ‹è¯•çš„åˆ†æ”¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ [blazediff](https://github.com/teimurjan/blazediff) å°†å½“å‰æˆªå›¾ä¸åŸºå‡†æˆªå›¾è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰å·®å¼‚ï¼Œå°†ä¼šç”Ÿæˆå·®å¼‚æˆªå›¾ï¼Œå¹¶å°†å·®å¼‚æŠ¥å‘Šä¸Šä¼ åˆ° OSS ä¸­ã€‚

è¿›ä¸€æ­¥åˆ©ç”¨ GitHub Actionsï¼Œå®ç°åœ¨ PR ä¸­å¯¹æ¯”åŸºå‡†æˆªå›¾ï¼Œå¦‚æœæœ‰è§†è§‰å·®å¼‚ï¼ŒCI ä¼šå°† PR ä¸­çš„å·®å¼‚æˆªå›¾å’ŒæŠ¥å‘Šä¸Šä¼ åˆ° OSS ä¸­ï¼Œåœ¨ PR ä¸­å±•ç¤ºè§†è§‰å·®å¼‚ï¼ŒåŒæ—¶æ ‡è®°ä¸ºå¤±è´¥ï¼Œéœ€è¦å¼€å‘è€…è¿›è¡Œä¿®å¤ã€‚

![https://github.com/ant-design/ant-design/pull/52210#issuecomment-2567659292](https://github.com/user-attachments/assets/8a5c4e0a-3686-4b1c-aa32-930505173abe)

## æœ¬åœ°è§†è§‰å›å½’æµ‹è¯•

åœ¨æœ¬åœ°å¼€å‘ï¼Œå‡†å¤‡æäº¤ PR è´¡çŒ®æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥äº‹å…ˆè¿›è¡Œè§†è§‰å›å½’æµ‹è¯•:

```bash
npm run test:visual-regression:local # æŒ‰ç…§æç¤ºé€‰æ‹©ç»„ä»¶è¿›è¡Œè§†è§‰å›å½’æµ‹è¯•
```

## ä»¥ä¸Š

- è§†è§‰å›å½’æŒç»­é›†æˆæ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒ [.github/workflows/visual-regression-\*.yml](https://github.com/search?q=repo%3Aant-design%2Fant-design%20path%3A%2F%5E%5C.github%5C%2Fworkflows%5C%2F%2F%20Visual%20Regression&type=code)
- åŸºå‡†æˆªå›¾å®ç°ï¼Œå¯ä»¥å‚è€ƒ [tests/shared/imageTest.tsx](https://github.com/ant-design/ant-design/blob/46a8eff/tests/shared/imageTest.tsx#L38)
- è§†è§‰å›å½’æµ‹è¯•çš„ä»£ç å®ç°ï¼Œå¯ä»¥å‚è€ƒ [scripts/visual-regression](https://github.com/ant-design/ant-design/tree/46a8eff/scripts/visual-regression)
