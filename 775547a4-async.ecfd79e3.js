(("undefined"!=typeof globalThis?globalThis:self).makoChunk_antd=("undefined"!=typeof globalThis?globalThis:self).makoChunk_antd||[]).push([["775547a4"],{"775547a4":function(e,t,i){"use strict";i.d(t,"__esModule",{value:!0}),i.d(t,"diagram",{enumerable:!0,get:function(){return K;}});var r=i("777fffbe"),s=i("0bc1a1a3"),n=i("4593e913"),o=i("bed241dc"),a=i("8d13cbfb"),l=i("4a9940fd"),d=i("b04a8d7d"),c=i("2bc3de4e"),f=r._(i("117d3e41")),h=r._(i("a79e3b61")),g=i("f604571d"),u={L:"left",R:"right",T:"top",B:"bottom"},p={L:(0,d.__name)(e=>`${e},${e/2} 0,${e} 0,0`,"L"),R:(0,d.__name)(e=>`0,${e/2} ${e},0 ${e},${e}`,"R"),T:(0,d.__name)(e=>`0,0 ${e},0 ${e/2},${e}`,"T"),B:(0,d.__name)(e=>`${e/2},0 ${e},${e} 0,${e}`,"B")},m={L:(0,d.__name)((e,t)=>e-t+2,"L"),R:(0,d.__name)((e,t)=>e-2,"R"),T:(0,d.__name)((e,t)=>e-t+2,"T"),B:(0,d.__name)((e,t)=>e-2,"B")},y=(0,d.__name)(function(e){return x(e)?"L"===e?"R":"L":"T"===e?"B":"T";},"getOppositeArchitectureDirection"),k=(0,d.__name)(function(e){return"L"===e||"R"===e||"T"===e||"B"===e;},"isArchitectureDirection"),x=(0,d.__name)(function(e){return"L"===e||"R"===e;},"isArchitectureDirectionX"),w=(0,d.__name)(function(e){return"T"===e||"B"===e;},"isArchitectureDirectionY"),b=(0,d.__name)(function(e,t){let i=x(e)&&w(t),r=w(e)&&x(t);return i||r;},"isArchitectureDirectionXY"),v=(0,d.__name)(function(e){let t=e[0],i=e[1],r=x(t)&&w(i),s=w(t)&&x(i);return r||s;},"isArchitecturePairXY"),_=(0,d.__name)(function(e){return"LL"!==e&&"RR"!==e&&"TT"!==e&&"BB"!==e;},"isValidArchitectureDirectionPair"),$=(0,d.__name)(function(e,t){let i=`${e}${t}`;return _(i)?i:void 0;},"getArchitectureDirectionPair"),E=(0,d.__name)(function([e,t],i){let r=i[0],s=i[1];return x(r)?w(s)?[e+("L"===r?-1:1),t+("T"===s?1:-1)]:[e+("L"===r?-1:1),t]:x(s)?[e+("L"===s?1:-1),t+("T"===r?1:-1)]:[e,t+("T"===r?1:-1)];},"shiftPositionByArchitectureDirectionPair"),T=(0,d.__name)(function(e){return"LT"===e||"TL"===e?[1,1]:"BL"===e||"LB"===e?[1,-1]:"BR"===e||"RB"===e?[-1,-1]:[-1,1];},"getArchitectureDirectionXYFactors"),D=(0,d.__name)(function(e,t){return b(e,t)?"bend":x(e)?"horizontal":"vertical";},"getArchitectureDirectionAlignment"),I=(0,d.__name)(function(e){return"service"===e.type;},"isArchitectureService"),S=(0,d.__name)(function(e){return"junction"===e.type;},"isArchitectureJunction"),B=(0,d.__name)(e=>e.data(),"edgeData"),C=(0,d.__name)(e=>e.data(),"nodeData"),L=l.defaultConfig_default.architecture,j=class{constructor(){this.nodes={},this.groups={},this.edges=[],this.registeredIds={},this.elements={},this.setAccTitle=l.setAccTitle,this.getAccTitle=l.getAccTitle,this.setDiagramTitle=l.setDiagramTitle,this.getDiagramTitle=l.getDiagramTitle,this.getAccDescription=l.getAccDescription,this.setAccDescription=l.setAccDescription,this.clear();}static #e=(0,d.__name)(this,"ArchitectureDB");clear(){this.nodes={},this.groups={},this.edges=[],this.registeredIds={},this.dataStructures=void 0,this.elements={},(0,l.clear)();}addService({id:e,icon:t,in:i,title:r,iconText:s}){if(void 0!==this.registeredIds[e])throw Error(`The service id [${e}] is already in use by another ${this.registeredIds[e]}`);if(void 0!==i){if(e===i)throw Error(`The service [${e}] cannot be placed within itself`);if(void 0===this.registeredIds[i])throw Error(`The service [${e}]'s parent does not exist. Please make sure the parent is created before this service`);if("node"===this.registeredIds[i])throw Error(`The service [${e}]'s parent is not a group`);}this.registeredIds[e]="node",this.nodes[e]={id:e,type:"service",icon:t,iconText:s,title:r,edges:[],in:i};}getServices(){return Object.values(this.nodes).filter(I);}addJunction({id:e,in:t}){this.registeredIds[e]="node",this.nodes[e]={id:e,type:"junction",edges:[],in:t};}getJunctions(){return Object.values(this.nodes).filter(S);}getNodes(){return Object.values(this.nodes);}getNode(e){return this.nodes[e]??null;}addGroup({id:e,icon:t,in:i,title:r}){var s,n,o;if((null===(s=this.registeredIds)||void 0===s?void 0:s[e])!==void 0)throw Error(`The group id [${e}] is already in use by another ${this.registeredIds[e]}`);if(void 0!==i){if(e===i)throw Error(`The group [${e}] cannot be placed within itself`);if((null===(n=this.registeredIds)||void 0===n?void 0:n[i])===void 0)throw Error(`The group [${e}]'s parent does not exist. Please make sure the parent is created before this group`);if((null===(o=this.registeredIds)||void 0===o?void 0:o[i])==="node")throw Error(`The group [${e}]'s parent is not a group`);}this.registeredIds[e]="group",this.groups[e]={id:e,icon:t,title:r,in:i};}getGroups(){return Object.values(this.groups);}addEdge({lhsId:e,rhsId:t,lhsDir:i,rhsDir:r,lhsInto:s,rhsInto:n,lhsGroup:o,rhsGroup:a,title:l}){if(!k(i))throw Error(`Invalid direction given for left hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${String(i)}`);if(!k(r))throw Error(`Invalid direction given for right hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${String(r)}`);if(void 0===this.nodes[e]&&void 0===this.groups[e])throw Error(`The left-hand id [${e}] does not yet exist. Please create the service/group before declaring an edge to it.`);if(void 0===this.nodes[t]&&void 0===this.groups[t])throw Error(`The right-hand id [${t}] does not yet exist. Please create the service/group before declaring an edge to it.`);let d=this.nodes[e].in,c=this.nodes[t].in;if(o&&d&&c&&d==c)throw Error(`The left-hand id [${e}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);if(a&&d&&c&&d==c)throw Error(`The right-hand id [${t}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);this.edges.push({lhsId:e,lhsDir:i,lhsInto:s,lhsGroup:o,rhsId:t,rhsDir:r,rhsInto:n,rhsGroup:a,title:l}),this.nodes[e]&&this.nodes[t]&&(this.nodes[e].edges.push(this.edges[this.edges.length-1]),this.nodes[t].edges.push(this.edges[this.edges.length-1]));}getEdges(){return this.edges;}getDataStructures(){if(void 0===this.dataStructures){let e={},t=Object.entries(this.nodes).reduce((t,[i,r])=>(t[i]=r.edges.reduce((t,r)=>{var s,n;let o=null===(s=this.getNode(r.lhsId))||void 0===s?void 0:s.in,a=null===(n=this.getNode(r.rhsId))||void 0===n?void 0:n.in;if(o&&a&&o!==a){let t=D(r.lhsDir,r.rhsDir);"bend"!==t&&(e[o]??(e[o]={}),e[o][a]=t,e[a]??(e[a]={}),e[a][o]=t);}if(r.lhsId===i){let e=$(r.lhsDir,r.rhsDir);e&&(t[e]=r.rhsId);}else{let e=$(r.rhsDir,r.lhsDir);e&&(t[e]=r.lhsId);}return t;},{}),t),{}),i=Object.keys(t)[0],r={[i]:1},s=Object.keys(t).reduce((e,t)=>t===i?e:{...e,[t]:1},{}),n=(0,d.__name)(e=>{let i={[e]:[0,0]},n=[e];for(;n.length>0;){let e=n.shift();if(e){r[e]=1,delete s[e];let o=t[e],[a,l]=i[e];Object.entries(o).forEach(([e,t])=>{r[t]||(i[t]=E([a,l],e),n.push(t));});}}return i;},"BFS"),o=[n(i)];for(;Object.keys(s).length>0;)o.push(n(Object.keys(s)[0]));this.dataStructures={adjList:t,spatialMaps:o,groupAlignments:e};}return this.dataStructures;}setElementForId(e,t){this.elements[e]=t;}getElementById(e){return this.elements[e];}getConfig(){return(0,a.cleanAndMerge)({...L,...(0,l.getConfig)().architecture});}getConfigField(e){return this.getConfig()[e];}},A=(0,d.__name)((e,t)=>{(0,o.populateCommonDb)(e,t),e.groups.map(e=>t.addGroup(e)),e.services.map(e=>t.addService({...e,type:"service"})),e.junctions.map(e=>t.addJunction({...e,type:"junction"})),e.edges.map(e=>t.addEdge(e));},"populateDb"),F={parser:{yy:void 0},parse:(0,d.__name)(async e=>{var t;let i=await (0,c.parse)("architecture",e);d.log.debug(i);let r=null===(t=F.parser)||void 0===t?void 0:t.yy;if(!(r instanceof j))throw Error("parser.parser?.yy was not a ArchitectureDB. This is due to a bug within Mermaid, please report this issue at https://github.com/mermaid-js/mermaid/issues.");A(i,r);},"parse")},O=(0,d.__name)(e=>`
  .edge {
    stroke-width: ${e.archEdgeWidth};
    stroke: ${e.archEdgeColor};
    fill: none;
  }

  .arrow {
    fill: ${e.archEdgeArrowColor};
  }

  .node-bkg {
    fill: none;
    stroke: ${e.archGroupBorderColor};
    stroke-width: ${e.archGroupBorderWidth};
    stroke-dasharray: 8;
  }
  .node-icon-text {
    display: flex; 
    align-items: center;
  }
  
  .node-icon-text > div {
    color: #fff;
    margin: 1px;
    height: fit-content;
    text-align: center;
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
  }
`,"getStyles"),R=(0,d.__name)(e=>`<g><rect width="80" height="80" style="fill: #087ebf; stroke-width: 0px;"/>${e}</g>`,"wrapIcon"),z={prefix:"mermaid-architecture",height:80,width:80,icons:{database:{body:R('<path id="b" data-name="4" d="m20,57.86c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="c" data-name="3" d="m20,45.95c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="d" data-name="2" d="m20,34.05c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse id="e" data-name="1" cx="40" cy="22.14" rx="20" ry="7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="20" y1="57.86" x2="20" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="60" y1="57.86" x2="60" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},server:{body:R('<rect x="17.5" y="17.5" width="45" height="45" rx="2" ry="2" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="32.5" x2="62.5" y2="32.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="47.5" x2="62.5" y2="47.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><g><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g>')},disk:{body:R('<rect x="20" y="15" width="40" height="50" rx="1" ry="1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="14" ry="14.58" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="4" ry="4.17" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m37.51,42.52l-4.83,13.22c-.26.71-1.1,1.02-1.76.64l-4.18-2.42c-.66-.38-.81-1.26-.33-1.84l9.01-10.8c.88-1.05,2.56-.08,2.09,1.2Z" style="fill: #fff; stroke-width: 0px;"/>')},internet:{body:R('<circle cx="40" cy="40" r="22.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="40" y1="17.5" x2="40" y2="62.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="40" x2="62.5" y2="40" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m39.99,17.51c-15.28,11.1-15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m40.01,17.51c15.28,11.1,15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="30.1" x2="60.25" y2="30.1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="49.9" x2="60.25" y2="49.9" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},cloud:{body:R('<path d="m65,47.5c0,2.76-2.24,5-5,5H20c-2.76,0-5-2.24-5-5,0-1.87,1.03-3.51,2.56-4.36-.04-.21-.06-.42-.06-.64,0-2.6,2.48-4.74,5.65-4.97,1.65-4.51,6.34-7.76,11.85-7.76.86,0,1.69.08,2.5.23,2.09-1.57,4.69-2.5,7.5-2.5,6.1,0,11.19,4.38,12.28,10.17,2.14.56,3.72,2.51,3.72,4.83,0,.03,0,.07-.01.1,2.29.46,4.01,2.48,4.01,4.9Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},unknown:n.unknownIcon,blank:{body:R("")}}},M=(0,d.__name)(async function(e,t,i){let r=i.getConfigField("padding"),s=i.getConfigField("iconSize"),o=s/2,d=s/6,c=d/2;await Promise.all(t.edges().map(async t=>{var s,f;let{source:h,sourceDir:g,sourceArrow:u,sourceGroup:y,target:k,targetDir:_,targetArrow:E,targetGroup:D,label:I}=B(t),{x:S,y:C}=t[0].sourceEndpoint(),{x:L,y:j}=t[0].midpoint(),{x:A,y:F}=t[0].targetEndpoint(),O=r+4;if(y&&(x(g)?S+="L"===g?-O:O:C+="T"===g?-O:O+18),D&&(x(_)?A+="L"===_?-O:O:F+="T"===_?-O:O+18),y||(null===(s=i.getNode(h))||void 0===s?void 0:s.type)!=="junction"||(x(g)?S+="L"===g?o:-o:C+="T"===g?o:-o),D||(null===(f=i.getNode(k))||void 0===f?void 0:f.type)!=="junction"||(x(_)?A+="L"===_?o:-o:F+="T"===_?o:-o),t[0]._private.rscratch){let t=e.insert("g");if(t.insert("path").attr("d",`M ${S},${C} L ${L},${j} L${A},${F} `).attr("class","edge").attr("id",(0,a.getEdgeId)(h,k,{prefix:"L"})),u){let e=x(g)?m[g](S,d):S-c,i=w(g)?m[g](C,d):C-c;t.insert("polygon").attr("points",p[g](d)).attr("transform",`translate(${e},${i})`).attr("class","arrow");}if(E){let e=x(_)?m[_](A,d):A-c,i=w(_)?m[_](F,d):F-c;t.insert("polygon").attr("points",p[_](d)).attr("transform",`translate(${e},${i})`).attr("class","arrow");}if(I){let e=b(g,_)?"XY":x(g)?"X":"Y",i=0;i="X"===e?Math.abs(S-A):"Y"===e?Math.abs(C-F)/1.5:Math.abs(S-A)/2;let r=t.append("g");if(await (0,n.createText)(r,I,{useHtmlLabels:!1,width:i,classes:"architecture-service-label"},(0,l.getConfig2)()),r.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),"X"===e)r.attr("transform","translate("+L+", "+j+")");else if("Y"===e)r.attr("transform","translate("+L+", "+j+") rotate(-90)");else if("XY"===e){let e=$(g,_);if(e&&v(e)){let t=r.node().getBoundingClientRect(),[i,s]=T(e);r.attr("dominant-baseline","auto").attr("transform",`rotate(${-1*i*s*45})`);let n=r.node().getBoundingClientRect();r.attr("transform",`
                translate(${L}, ${j-t.height/2})
                translate(${i*n.width/2}, ${s*n.height/2})
                rotate(${-1*i*s*45}, 0, ${t.height/2})
              `);}}}}}));},"drawEdges"),P=(0,d.__name)(async function(e,t,i){let r=.75*i.getConfigField("padding"),s=i.getConfigField("fontSize"),o=i.getConfigField("iconSize")/2;await Promise.all(t.nodes().map(async t=>{let a=C(t);if("group"===a.type){let{h:d,w:c,x1:f,y1:h}=t.boundingBox(),g=e.append("rect");g.attr("id",`group-${a.id}`).attr("x",f+o).attr("y",h+o).attr("width",c).attr("height",d).attr("class","node-bkg");let u=e.append("g"),p=f,m=h;if(a.icon){let e=u.append("g");e.html(`<g>${await (0,n.getIconSVG)(a.icon,{height:r,width:r,fallbackPrefix:z.prefix})}</g>`),e.attr("transform","translate("+(p+o+1)+", "+(m+o+1)+")"),p+=r,m+=s/2-1-2;}if(a.label){let e=u.append("g");await (0,n.createText)(e,a.label,{useHtmlLabels:!1,width:c,classes:"architecture-service-label"},(0,l.getConfig2)()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","start").attr("text-anchor","start"),e.attr("transform","translate("+(p+o+4)+", "+(m+o+2)+")");}i.setElementForId(a.id,g);}}));},"drawGroups"),G=(0,d.__name)(async function(e,t,i){let r=(0,l.getConfig2)();for(let s of i){let i=t.append("g"),o=e.getConfigField("iconSize");if(s.title){let e=i.append("g");await (0,n.createText)(e,s.title,{useHtmlLabels:!1,width:1.5*o,classes:"architecture-service-label"},r),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),e.attr("transform","translate("+o/2+", "+o+")");}let a=i.append("g");if(s.icon)a.html(`<g>${await (0,n.getIconSVG)(s.icon,{height:o,width:o,fallbackPrefix:z.prefix})}</g>`);else if(s.iconText){a.html(`<g>${await (0,n.getIconSVG)("blank",{height:o,width:o,fallbackPrefix:z.prefix})}</g>`);let e=a.append("g").append("foreignObject").attr("width",o).attr("height",o).append("div").attr("class","node-icon-text").attr("style",`height: ${o}px;`).append("div").html((0,l.sanitizeText)(s.iconText,r)),t=parseInt(window.getComputedStyle(e.node(),null).getPropertyValue("font-size").replace(/\D/g,""))??16;e.attr("style",`-webkit-line-clamp: ${Math.floor((o-2)/t)};`);}else a.append("path").attr("class","node-bkg").attr("id","node-"+s.id).attr("d",`M0 ${o} v${-o} q0,-5 5,-5 h${o} q5,0 5,5 v${o} H0 Z`);i.attr("id",`service-${s.id}`).attr("class","architecture-service");let{width:d,height:c}=i.node().getBBox();s.width=d,s.height=c,e.setElementForId(s.id,i);}return 0;},"drawServices"),N=(0,d.__name)(function(e,t,i){i.forEach(i=>{let r=t.append("g"),s=e.getConfigField("iconSize");r.append("g").append("rect").attr("id","node-"+i.id).attr("fill-opacity","0").attr("width",s).attr("height",s),r.attr("class","architecture-junction");let{width:n,height:o}=r._groups[0][0].getBBox();r.width=n,r.height=o,e.setElementForId(i.id,r);});},"drawJunctions");function X(e,t,i){e.forEach(e=>{t.add({group:"nodes",data:{type:"service",id:e.id,icon:e.icon,label:e.title,parent:e.in,width:i.getConfigField("iconSize"),height:i.getConfigField("iconSize")},classes:"node-service"});});}function Y(e,t,i){e.forEach(e=>{t.add({group:"nodes",data:{type:"junction",id:e.id,parent:e.in,width:i.getConfigField("iconSize"),height:i.getConfigField("iconSize")},classes:"node-junction"});});}function Z(e,t){t.nodes().map(t=>{let i=C(t);"group"!==i.type&&(i.x=t.position().x,i.y=t.position().y,e.getElementById(i.id).attr("transform","translate("+(i.x||0)+","+(i.y||0)+")"));});}function J(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"group",id:e.id,icon:e.icon,label:e.title,parent:e.in},classes:"node-group"});});}function q(e,t){e.forEach(e=>{let{lhsId:i,rhsId:r,lhsInto:s,lhsGroup:n,rhsInto:o,lhsDir:a,rhsDir:l,rhsGroup:d,title:c}=e,f=b(e.lhsDir,e.rhsDir)?"segments":"straight",h={id:`${i}-${r}`,label:c,source:i,sourceDir:a,sourceArrow:s,sourceGroup:n,sourceEndpoint:"L"===a?"0 50%":"R"===a?"100% 50%":"T"===a?"50% 0":"50% 100%",target:r,targetDir:l,targetArrow:o,targetGroup:d,targetEndpoint:"L"===l?"0 50%":"R"===l?"100% 50%":"T"===l?"50% 0":"50% 100%"};t.add({group:"edges",data:h,classes:f});});}function V(e,t,i){let r=(0,d.__name)((e,t)=>Object.entries(e).reduce((e,[r,s])=>{let n=0,o=Object.entries(s);if(1===o.length)return e[r]=o[0][1],e;for(let s=0;s<o.length-1;s++)for(let l=s+1;l<o.length;l++){var a;let[d,c]=o[s],[f,h]=o[l];(null===(a=i[d])||void 0===a?void 0:a[f])===t?(e[r]??(e[r]=[]),e[r]=[...e[r],...c,...h]):"default"===d||"default"===f?(e[r]??(e[r]=[]),e[r]=[...e[r],...c,...h]):(e[`${r}-${n++}`]=c,e[`${r}-${n++}`]=h);}return e;},{}),"flattenAlignments"),[s,n]=t.map(t=>{let i={},s={};return Object.entries(t).forEach(([t,[r,n]])=>{var o,a,l;let d=(null===(o=e.getNode(t))||void 0===o?void 0:o.in)??"default";i[n]??(i[n]={}),(a=i[n])[d]??(a[d]=[]),i[n][d].push(t),s[r]??(s[r]={}),(l=s[r])[d]??(l[d]=[]),s[r][d].push(t);}),{horiz:Object.values(r(i,"horizontal")).filter(e=>e.length>1),vert:Object.values(r(s,"vertical")).filter(e=>e.length>1)};}).reduce(([e,t],{horiz:i,vert:r})=>[[...e,...i],[...t,...r]],[[],[]]);return{horizontal:s,vertical:n};}function H(e,t){let i=[],r=(0,d.__name)(e=>`${e[0]},${e[1]}`,"posToStr"),s=(0,d.__name)(e=>e.split(",").map(e=>parseInt(e)),"strToPos");return e.forEach(e=>{let n=Object.fromEntries(Object.entries(e).map(([e,t])=>[r(t),e])),o=[r([0,0])],a={},l={L:[-1,0],R:[1,0],T:[0,1],B:[0,-1]};for(;o.length>0;){let e=o.shift();if(e){a[e]=1;let d=n[e];if(d){let c=s(e);Object.entries(l).forEach(([e,s])=>{let l=r([c[0]+s[0],c[1]+s[1]]),f=n[l];f&&!a[l]&&(o.push(l),i.push({[u[e]]:f,[u[y(e)]]:d,gap:1.5*t.getConfigField("iconSize")}));});}}}}),i;}function W(e,t,i,r,s,{spatialMaps:n,groupAlignments:o}){return new Promise(a=>{let l=(0,g.select)("body").append("div").attr("id","cy").attr("style","display:none"),c=(0,f.default)({container:document.getElementById("cy"),style:[{selector:"edge",style:{"curve-style":"straight",label:"data(label)","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"edge.segments",style:{"curve-style":"segments","segment-weights":"0","segment-distances":[.5],"edge-distances":"endpoints","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"node",style:{"compound-sizing-wrt-labels":"include"}},{selector:"node[label]",style:{"text-valign":"bottom","text-halign":"center","font-size":`${s.getConfigField("fontSize")}px`}},{selector:".node-service",style:{label:"data(label)",width:"data(width)",height:"data(height)"}},{selector:".node-junction",style:{width:"data(width)",height:"data(height)"}},{selector:".node-group",style:{padding:`${s.getConfigField("padding")}px`}}],layout:{name:"grid",boundingBox:{x1:0,x2:100,y1:0,y2:100}}});l.remove(),J(i,c),X(e,c,s),Y(t,c,s),q(r,c);let h=V(s,n,o),u=H(n,s),p=c.layout({name:"fcose",quality:"proof",styleEnabled:!1,animate:!1,nodeDimensionsIncludeLabels:!1,idealEdgeLength(e){let[t,i]=e.connectedNodes(),{parent:r}=C(t),{parent:n}=C(i);return r===n?1.5*s.getConfigField("iconSize"):.5*s.getConfigField("iconSize");},edgeElasticity(e){let[t,i]=e.connectedNodes(),{parent:r}=C(t),{parent:s}=C(i);return r===s?.45:.001;},alignmentConstraint:h,relativePlacementConstraint:u});p.one("layoutstop",()=>{function e(e,t,i,r){let s,n;let{x:o,y:a}=e,{x:l,y:d}=t;n=(r-a+(o-i)*(a-d)/(o-l))/Math.sqrt(1+Math.pow((a-d)/(o-l),2)),s=Math.sqrt(Math.pow(r-a,2)+Math.pow(i-o,2)-Math.pow(n,2))/Math.sqrt(Math.pow(l-o,2)+Math.pow(d-a,2));let c=(l-o)*(r-a)-(d-a)*(i-o);switch(!0){case c>=0:c=1;break;case c<0:c=-1;}let f=(l-o)*(i-o)+(d-a)*(r-a);switch(!0){case f>=0:f=1;break;case f<0:f=-1;}return{distances:n=Math.abs(n)*c,weights:s*=f};}for(let i of((0,d.__name)(e,"getSegmentWeights"),c.startBatch(),Object.values(c.edges()))){var t;if(null===(t=i.data)||void 0===t?void 0:t.call(i)){let{x:t,y:r}=i.source().position(),{x:s,y:n}=i.target().position();if(t!==s&&r!==n){let t=i.sourceEndpoint(),r=i.targetEndpoint(),{sourceDir:s}=B(i),[n,o]=w(s)?[t.x,r.y]:[r.x,t.y],{weights:a,distances:l}=e(t,r,n,o);i.style("segment-distances",l),i.style("segment-weights",a);}}}c.endBatch(),p.run();}),p.run(),c.ready(e=>{d.log.info("Ready",e),a(c);});});}(0,n.registerIconPacks)([{name:z.prefix,icons:z}]),f.default.use(h.default),(0,d.__name)(X,"addServices"),(0,d.__name)(Y,"addJunctions"),(0,d.__name)(Z,"positionNodes"),(0,d.__name)(J,"addGroups"),(0,d.__name)(q,"addEdges"),(0,d.__name)(V,"getAlignments"),(0,d.__name)(H,"getRelativeConstraints"),(0,d.__name)(W,"layoutArchitecture");var K={parser:F,get db(){return new j;},renderer:{draw:(0,d.__name)(async(e,t,i,r)=>{let n=r.db,o=n.getServices(),a=n.getJunctions(),d=n.getGroups(),c=n.getEdges(),f=n.getDataStructures(),h=(0,s.selectSvgElement)(t),g=h.append("g");g.attr("class","architecture-edges");let u=h.append("g");u.attr("class","architecture-services");let p=h.append("g");p.attr("class","architecture-groups"),await G(n,u,o),N(n,u,a);let m=await W(o,a,d,c,n,f);await M(g,m,n),await P(p,m,n),Z(n,m),(0,l.setupGraphViewbox)(void 0,h,n.getConfigField("padding"),n.getConfigField("useMaxWidth"));},"draw")},styles:O};}}]);